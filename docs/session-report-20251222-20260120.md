# EPD Clock Session Report: 29-Day Continuous Operation

**Session Period**: 2025-12-22 10:25 ~ 2026-01-20 10:24 (ongoing)
**Duration**: ~29 days
**Report Generated**: 2026-01-20

---

## Executive Summary

The EPD Clock device achieved **29 days of continuous operation** with exceptional stability. The system collected **41,762 sensor readings** with only 13 minor gaps (max 8 minutes). Battery performance showed approximately 6-7 days runtime per charge cycle. A battery sensor issue was detected starting 2026-01-18 21:01.

---

## 1. Session Overview

| Metric | Value |
|--------|-------|
| Start Time | 2025-12-22 10:25:05 |
| End Time | 2026-01-20 10:24:01 (ongoing) |
| Total Duration | ~29 days |
| Total Sensor Readings | 41,762 |
| Data Gaps (>2 min) | 13 occurrences |
| Maximum Gap | 8 minutes |

---

## 2. Battery Performance

### 2.1 Charge Cycles

The device went through **3 charge cycles** during the 29-day period:

| Cycle | Discharge Start | Discharge End | Duration | Notes |
|-------|-----------------|---------------|----------|-------|
| 1 | 12/22 (87.5%) | 12/26 (46.4%) | ~4 days | Charged on 12/27-28 |
| 2 | 12/28 (73.4%) | 01/08 (13.3%) | ~11 days | Charged on 01/09 |
| 3 | 01/10 (87.5%) | 01/18 (8.3%) | ~8 days | Battery sensor failed |

### 2.2 Daily Battery Trend

```
Date        Voltage   Linear%   MAX17048%
──────────────────────────────────────────
2025-12-22  4.100V    87.5%     100.0%
2025-12-23  4.115V    89.4%     100.0%
2025-12-24  4.095V    86.9%     100.0%
2025-12-25  3.860V    57.5%     58.5%
2025-12-26  3.771V    46.4%     33.0%
2025-12-28  3.987V    73.4%     100.0%  ← Charged
2025-12-29  4.000V    75.0%     78.0%
2025-12-30  4.126V    90.8%     100.0%
2025-12-31  4.088V    85.9%     100.0%
2026-01-01  3.925V    65.6%     67.7%
2026-01-02  3.839V    54.8%     52.7%
2026-01-03  3.756V    44.5%     27.8%
2026-01-04  3.684V    35.5%     9.5%
2026-01-05  3.630V    28.8%     4.4%
2026-01-06  3.590V    23.7%     2.3%
2026-01-07  3.559V    19.8%     1.9%
2026-01-08  3.506V    13.3%     1.3%
2026-01-10  4.100V    87.5%     90.4%   ← Charged
2026-01-11  3.996V    74.5%     77.0%
2026-01-12  3.905V    63.1%     65.3%
2026-01-13  3.821V    52.7%     46.9%
2026-01-14  3.740V    42.5%     20.9%
2026-01-15  3.664V    33.0%     7.4%
2026-01-17  3.569V    21.1%     2.0%
2026-01-18  3.520V    15.0%     1.5%
```

### 2.3 Detailed Last Discharge Cycle (Jan 10 - Jan 18)

This section provides detailed analysis of the final complete discharge cycle before battery sensor failure.

#### 2.3.1 Overview

| Metric | Value |
|--------|-------|
| Start | 2026-01-10 00:00:00 |
| End | 2026-01-18 21:00:00 |
| Duration | **8.88 days (213.0 hours)** |
| Start Voltage | 4.100V (87.5%) |
| End Voltage | 3.466V (8.3%) |
| Total Voltage Drop | 634mV |
| Total Percent Drop | 79.2% |
| Avg Discharge Rate | **8.9%/day, 71.4mV/day** |
| Valid Readings | 11,616 |

#### 2.3.2 Battery Trend (6-Hour Intervals)

```
DateTime              Voltage  Linear%  Gauge%
────────────────────────────────────────────────────
2026.01.10 00:00:00  4.100V    87.5%    90.4%   ← Full charge
2026.01.10 06:00:00  4.073V    84.1%    86.6%
2026.01.10 12:00:00  4.048V    80.9%    83.8%
2026.01.10 18:00:00  4.020V    77.5%    80.6%
2026.01.11 00:00:00  3.996V    74.5%    77.0%
2026.01.11 06:00:00  3.974V    71.7%    73.9%
2026.01.11 12:00:00  3.951V    68.9%    70.9%
2026.01.11 18:00:00  3.926V    65.8%    68.2%
2026.01.12 00:00:00  3.905V    63.1%    65.3%
2026.01.12 06:00:00  3.885V    60.6%    63.1%
2026.01.12 12:00:00  3.862V    57.8%    59.2%
2026.01.12 18:00:00  3.839V    54.8%    53.8%
2026.01.13 00:00:00  3.821V    52.7%    46.9%
2026.01.13 06:00:00  3.797V    49.7%    41.2%
2026.01.13 12:00:00  3.780V    47.5%    35.4%
2026.01.13 18:00:00  3.760V    45.0%    28.3%
2026.01.14 00:00:00  3.740V    42.5%    20.9%
2026.01.14 06:00:00  3.720V    40.0%    17.0%
2026.01.14 12:00:00  3.700V    37.5%    13.6%
2026.01.14 18:00:00  3.685V    35.6%    10.0%
2026.01.15 00:00:00  3.664V    33.0%     7.4%
2026.01.15 06:00:00  3.649V    31.1%     5.7%
2026.01.15 12:00:00  3.634V    29.2%     4.8%
2026.01.16 12:00:00  3.576V    22.0%     2.1%   ← Entering low-voltage region
2026.01.16 18:00:00  3.570V    21.2%     2.0%
2026.01.17 00:00:00  3.569V    21.1%     2.0%
2026.01.17 06:00:00  3.560V    20.0%     1.9%
2026.01.17 12:00:00  3.547V    18.4%     1.7%
2026.01.17 18:00:00  3.537V    17.2%     1.6%
2026.01.18 00:00:00  3.520V    15.0%     1.5%
2026.01.18 06:00:00  3.517V    14.7%     1.3%
2026.01.18 12:00:00  3.493V    11.6%     1.2%
2026.01.18 18:00:00  3.476V     9.5%     1.0%
2026.01.18 21:00:00  3.466V     8.3%     0.8%   ← Last valid reading
```

#### 2.3.3 Daily Statistics

| Date | Battery Start→End | Daily Drop | Avg Temp | Avg CO2 |
|------|-------------------|------------|----------|---------|
| 01/10 | 4.100V→3.996V (87.5%→74.5%) | 104mV, 13.0% | 20.5°C | 799 ppm |
| 01/11 | 3.996V→3.908V (74.5%→63.4%) | 88mV, 11.1% | 19.8°C | 657 ppm |
| 01/12 | 3.905V→3.820V (63.1%→52.5%) | 85mV, 10.6% | 20.0°C | 797 ppm |
| 01/13 | 3.821V→3.737V (52.7%→42.2%) | 84mV, 10.5% | 20.4°C | 795 ppm |
| 01/14 | 3.740V→3.666V (42.5%→33.3%) | 74mV, 9.2% | 20.6°C | 693 ppm |
| 01/15 | 3.664V→3.628V (33.0%→28.4%) | 36mV, 4.6% | 20.5°C | 826 ppm |
| 01/16 | 3.561V→3.566V (20.2%→20.8%) | -5mV, -0.6%* | 21.8°C | 748 ppm |
| 01/17 | 3.569V→3.523V (21.1%→15.3%) | 46mV, 5.8% | 21.4°C | 733 ppm |
| 01/18 | 3.520V→3.466V (15.0%→8.3%) | 54mV, 6.7% | 21.2°C | 750 ppm |

*Note: Slight voltage increase on 01/16 likely due to temperature effect (warmer day)

#### 2.3.4 Discharge Curve Observations

1. **High voltage region (4.1V - 3.8V)**: Consistent ~10-13% daily discharge
2. **Mid voltage region (3.8V - 3.6V)**: Discharge rate decreases to ~5-10%/day
3. **Low voltage region (<3.6V)**: Non-linear behavior, voltage drop slows significantly
4. **Temperature correlation**: Warmer temperatures (01/16: 21.8°C avg) showed slight voltage recovery

#### 2.3.5 Battery Sensor Failure Transition

The exact moment when battery sensor readings became null:

```
Time       Voltage  Linear%  Gauge%   Temp   CO2
───────────────────────────────────────────────────────
20:55:00  3.471V     8.9%     0.9%  20.8°C  829 ppm
20:56:00  3.476V     9.5%     0.8%  20.8°C  850 ppm
20:57:00  3.474V     9.2%     0.8%  20.8°C  823 ppm
20:58:00  3.471V     8.9%     0.8%  20.8°C  870 ppm
20:59:00  3.470V     8.7%     0.7%  20.8°C  886 ppm
21:00:00  3.466V     8.3%     0.8%  20.8°C  814 ppm  ← LAST VALID
21:01:07  NULL      NULL     NULL   20.8°C  794 ppm  ← SENSOR FAILURE
21:02:03  NULL      NULL     NULL   20.8°C  918 ppm
21:03:01  NULL      NULL     NULL   20.8°C  775 ppm
...continues as NULL...
```

**Key observations:**
- Sensor failure occurred abruptly between 21:00:00 and 21:01:07
- No gradual degradation - instant transition to null
- Temperature and CO2 sensors continued working normally
- MAX17048 gauge was at 0.8% (near-empty state) when failure occurred
- Likely cause: I2C communication failure with MAX17048 at low voltage

### 2.4 Battery Sensor Issue (Summary)

**Problem**: Battery readings became `null` starting 2026-01-18 21:01:07

- Last valid reading: 2026-01-18 21:00:00 - 3.466V, 8.3%, 0.8%
- First null reading: 2026-01-18 21:01:07
- Brief recovery: 2026-01-19 18:58-19:00 (3.408V, 0.9%)
- Status: Intermittent failure, likely MAX17048 or I2C issue

---

## 3. RTC Drift Compensation

### 3.1 Statistics

| Metric | Value |
|--------|-------|
| Drift Rate (min) | -600.0 ms/min |
| Drift Rate (max) | +202.7 ms/min |
| Drift Rate (avg) | -395.0 ms/min |
| Total Measurements | 650 hourly samples |
| Cumulative Compensation | -30,663 ms (-30.7 sec) |

### 3.2 Observations

- The drift rate frequently hits the **-600 ms/min clamp** (negative limit)
- This indicates the RTC has a significant negative drift (clock runs slow)
- Over 29 days, approximately **30.7 seconds** of drift was corrected
- Average drift: ~1 second per day

### 3.3 Sample Data

```
First entries (Dec 22):
  2025.12.22 12:02:16: drift=510ms, cumulative=0ms
  2025.12.22 13:02:20: drift=510ms

Last entries (Jan 19):
  2026.01.19 15:00:00: drift=-1486ms, cumulative=-30668ms, rate=-600.0ms/min
  2026.01.19 16:00:00: drift=-1262ms, cumulative=-30665ms, rate=-600.0ms/min
  2026.01.19 19:00:00: drift=-1612ms, cumulative=-30663ms, rate=-600.0ms/min
```

---

## 4. Environmental Sensor Data

### 4.1 Summary Statistics

| Sensor | Min | Max | Average |
|--------|-----|-----|---------|
| Temperature | 17.9°C | 24.5°C | 21.0°C |
| Humidity | 22.3% | 51.8% | 34.1% |
| CO2 | 319 ppm | 1595 ppm | 763 ppm |

### 4.2 CO2 Distribution

| Level | Range | Count | Percentage |
|-------|-------|-------|------------|
| Excellent | <600 ppm | 9,684 | 23.2% |
| Good | 600-999 ppm | 26,377 | 63.2% |
| Moderate | 1000-1499 ppm | 5,674 | 13.6% |
| Poor | ≥1500 ppm | 27 | 0.1% |

**86.4% of readings were at good or excellent levels (<1000 ppm)**

### 4.3 Daily CO2 Averages

```
Date        Avg CO2   Max CO2
────────────────────────────
2025-12-22  721 ppm   1007 ppm
2025-12-23  765 ppm   1238 ppm
2025-12-24  799 ppm   1558 ppm
2025-12-25  840 ppm   1278 ppm
2025-12-26  658 ppm   1033 ppm
2025-12-27  716 ppm   995 ppm
2025-12-28  737 ppm   1061 ppm
2025-12-29  740 ppm   1101 ppm
2025-12-30  654 ppm   982 ppm
2025-12-31  750 ppm   1595 ppm  ← New Year's Eve peak
2026-01-01  564 ppm   1178 ppm
2026-01-02  546 ppm   1242 ppm
2026-01-03  1024 ppm  1448 ppm  ← Elevated
2026-01-04  988 ppm   1540 ppm  ← Elevated
2026-01-05  813 ppm   1274 ppm
2026-01-06  690 ppm   1170 ppm
2026-01-07  751 ppm   1334 ppm
2026-01-08  778 ppm   1330 ppm
2026-01-09  972 ppm   1426 ppm
2026-01-10  799 ppm   1318 ppm
2026-01-11  657 ppm   1303 ppm
2026-01-12  797 ppm   1114 ppm
2026-01-13  795 ppm   1164 ppm
2026-01-14  693 ppm   1176 ppm
2026-01-15  777 ppm   1157 ppm
2026-01-16  764 ppm   1337 ppm
2026-01-17  733 ppm   1237 ppm
2026-01-18  783 ppm   1178 ppm
2026-01-19  773 ppm   1231 ppm
2026-01-20  851 ppm   1282 ppm
```

---

## 5. Errors and Warnings

### 5.1 NTP Timeouts

Several NTP timeout warnings were recorded:
```
[WARN] [Network] NTP: No response from ntp.nict.jp after 2000ms (size=0)
```
These occurred during WiFi sync cycles but did not affect overall operation.

### 5.2 Drift Rate Clamping (Legacy)

Early in the session (before code update), drift rates were clamped at ±300 ms/min:
```
[WARN] [DeepSleep] Rate -318.5 clamped to -300.0 ms/min
[WARN] [DeepSleep] Rate -323.6 clamped to -300.0 ms/min
```
This was later updated to ±600 ms/min to accommodate larger drift values.

### 5.3 Data Gaps

| Timestamp | Duration | Notes |
|-----------|----------|-------|
| 2025-12-22 11:00 | 3 min | Minor |
| 2025-12-22 22:47 | 5 min | Minor |
| 2025-12-26 00:33 | 8 min | Longest gap |
| 2025-12-27 14:17 | 7 min | Minor |
| 2025-12-28 15:41 | 4 min | Minor |
| + 8 more | 2-3 min | Minor |

---

## 6. Serial Log Coverage

| Log File | Period | Boot Count | Duration |
|----------|--------|------------|----------|
| serial_20251229_113409.log | 12/29 11:34 - 16:06 | 5 → 242 | 4.5 hours |
| serial_20251229_222147.log | 12/29 22:21 - 12/30 11:08 | 617 → 51* | 13 hours |
| serial_20251230_192603.log | 12/30 19:26 - 12/31 10:54 | 550 → 1478 | 15.5 hours |
| serial_20251231_105628.log | 12/31 10:56 - 11:19 | 1480 → 1503 | 24 min |

*Note: Boot count reset detected between sessions

**No serial logs after 2025-12-31** (device running without serial connection)

---

## 7. Conclusions

### Successes
1. **29 days continuous operation** - Exceptional stability
2. **41,762 sensor readings** with minimal data loss
3. **6-7 days battery life** per charge cycle
4. **RTC drift compensation working** - ~1 sec/day correction applied

### Issues to Investigate
1. **Battery sensor failure** (2026-01-18 21:01~) - MAX17048 or I2C communication issue
2. **RTC drift consistently at -600ms/min clamp** - Consider adjusting clamp range or investigating RTC quality
3. **NTP timeout warnings** - May need fallback NTP servers

### Recommendations
1. Investigate MAX17048 battery gauge intermittent failure
2. Consider adding secondary NTP server (e.g., time.google.com)
3. Monitor if drift rate clamp at -600ms/min is sufficient for long-term accuracy

---

## Appendix: Data Files

- Sensor logs: `/logs/sensor_logs/sensor_log_YYYYMMDD.jsonl`
- Serial logs: `/logs/serial_logs/serial_YYYYMMDD_HHMMSS.log`
- Error logs: `/logs/error_logs/error_YYYYMMDD.log`
